<!DOCTYPE html>
<html>
<head>
  <meta charSet='utf-8' />
  <title>ko-cola - decorator的mvc开发模式</title>
  <link href='/doc/css/docs.css' rel='stylesheet'>
  <link href='/doc/css/github-markdown.css' rel='stylesheet'>
  <script>
    window.onunload = function(){
      var scollTop = document.getElementsByClassName('menu-nav')[0].scrollTop;
      document.cookie = 'scollTop=' + scollTop;
    }
    window.onload = function(){
      var scrollTop = /scollTop=(\d+)/.test(document.cookie) && RegExp.$1;
      document.getElementsByClassName('menu-nav')[0].style.overflowY='scroll'
      document.getElementsByClassName('menu-nav')[0].scrollTop = scrollTop || 0;
      document.getElementsByClassName('menu-nav')[0].style.overflowY='hidden'
    }
  </script>
</head>
<body>
  <div class='menu'>
    <div class='logo'>
      <a href="https://www.github.com/hcnode/koa-cola"><img src="/doc/images/github.png" width="25"></a>&nbsp;&nbsp;Koa-cola
    </div>
    <nav class='menu-nav' style="max-height: 87%;" onmouseover="this.style.overflowY='scroll'"  onmouseout="this.style.overflowY='hidden'">
      
        <ul class='nav'>
          <span>介绍</span>
          <ul class='nav'>
            
              <li>
              
                 <a href='/doc/index.html'>koa-cola是什么?</a>
              
              </li>
            
              <li>
              
                 <a href='/doc/ssr.html'>SSR和SPA</a>
              
              </li>
            
              <li>
              
                 <a href='/doc/compare-next.html'>对比next.js</a>
              
              </li>
            
              <li>
              
                 <a href='/doc/universal.html'>Universal 前后端全栈开发</a>
              
              </li>
            
              <li>
              
                 <a href='/doc/d-mvc.html' class='active'>decorator的mvc开发模式</a>
              
              </li>
            
          </ul>
        </ul>
      
        <ul class='nav'>
          <span>使用方法</span>
          <ul class='nav'>
            
              <li>
              
                 <a href='/doc/installation.html'>如何使用</a>
              
              </li>
            
              <li>
              
                 <a href='/doc/cli.html'>Cli命令</a>
              
              </li>
            
          </ul>
        </ul>
      
        <ul class='nav'>
          <span>在线演示</span>
          <ul class='nav'>
            
              <li>
              
                 <a href='http://www.koa-cola.com:3000'>todolist例子</a>
              
              </li>
            
          </ul>
        </ul>
      
        <ul class='nav'>
          <span>Tips</span>
          <ul class='nav'>
            
              <li>
              
                 <a href='/doc/tip1-react-init.html'>初始化react组件数据</a>
              
              </li>
            
              <li>
              
                 <a href='/doc/tip2-redux.html'>redux-connect组件的redux坑</a>
              
              </li>
            
              <li>
              
                 <a href='/doc/tip3-inject-global.html'>Inject global全局注入</a>
              
              </li>
            
              <li>
              
                 <a href='/doc/tip4-cluster.html'>cluster集群模式</a>
              
              </li>
            
              <li>
              
                 <a href='/doc/tip5-debug.html'>调试</a>
              
              </li>
            
              <li>
              
                 <a href='/doc/tip6-compile.html'>代码编译</a>
              
              </li>
            
          </ul>
        </ul>
      
        <ul class='nav'>
          <span>目录结构</span>
          <ul class='nav'>
            
              <li>
              
                <a href='/doc/api.html' style="padding:0px">api</a>
                <ul class='nav' style="padding-top:0px">
                  
                    <li style="height:28px">
                      <a href='/doc/api-controllers.html'>controllers</a>
                    </li>
                  
                    <li style="height:28px">
                      <a href='/doc/api-models.html'>models</a>
                    </li>
                  
                    <li style="height:28px">
                      <a href='/doc/api-schemas.html'>schemas</a>
                    </li>
                  
                    <li style="height:28px">
                      <a href='/doc/api-responses.html'>responses</a>
                    </li>
                  
                </ul>
              
              </li>
            
              <li>
              
                 <a href='/doc/config.html'>config</a>
              
              </li>
            
              <li>
              
                 <a href='/doc/public.html'>public</a>
              
              </li>
            
              <li>
              
                <a href='/doc/views.html' style="padding:0px">views</a>
                <ul class='nav' style="padding-top:0px">
                  
                    <li style="height:28px">
                      <a href='/doc/views-pages.html'>pages</a>
                    </li>
                  
                    <li style="height:28px">
                      <a href='/doc/views-app.html'>app.tsx</a>
                    </li>
                  
                    <li style="height:28px">
                      <a href='/doc/views-components.html'>components</a>
                    </li>
                  
                </ul>
              
              </li>
            
          </ul>
        </ul>
      
    </nav>
  </div>
  <div class='page'>
    <div class='page-content'>
      <h1>decorator的mvc开发模式</h1>
      <div style="
          float: right;
          top: -60px;
          position: relative;
          margin-right: 10px;
      "><a href="https://github.com/koa-cola/website/blob/master/source/d-mvc.md">修改</a></div>
      <p>koa-cola可以使用es7的decorator装饰器开发模式来写mvc，controller是必须用提供的decorator来开发（因为涉及到router相关的定义），model和view层则没有强制需要demo所演示的decorator来开发。</p>
<h3>Controller</h3>
<p>使用decorator装饰器来注入相关依赖，路由层的decorators包括router、中间件、response、view，响应阶段的decorators包括koa.Context、param、response、request等，比如以下例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> &#123; </div><div class="line">    Controller, Get, Use, Param, Body, Delete, Put, Post, QueryParam, View, Ctx, Response </div><div class="line">&#125; = <span class="built_in">require</span>(<span class="string">'koa-cola'</span>).Decorators.controller;</div><div class="line"><span class="keyword">import</span> Ok <span class="keyword">from</span> <span class="string">'../responses/ok'</span>;</div><div class="line"></div><div class="line">@Controller(<span class="string">''</span>) </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">FooController</span> </span>&#123;</div><div class="line">    @Get(<span class="string">'/some_api'</span>)  <span class="comment">// 定义 router 以及 method</span></div><div class="line">    @Response(Ok)      <span class="comment">// 定义 API 返回的数据结构</span></div><div class="line">    some_api (@Ctx() ctx, @QueryParam() param : any) &#123; <span class="comment">// 注入 ctx 和 param</span></div><div class="line">        <span class="comment">// 初始化数据，数据将会以 “Ok” 定义的格式返回</span></div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            foo : <span class="string">'bar'</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Get(<span class="string">'/some_page'</span>)  <span class="comment">// 定义 router 以及 method</span></div><div class="line">    @View(<span class="string">'some_page'</span>)  <span class="comment">// 在 /views/pages/ 下有对应的 some_page.tsx 页面</span></div><div class="line">    some_page (@Ctx() ctx, @QueryParam() param : any) &#123; <span class="comment">// 注入ctx和param</span></div><div class="line">        <span class="comment">// 初始化数据，数据将会注入到react组件的props，如：this.props.ctrl.foo</span></div><div class="line">        <span class="keyword">return</span> &#123;</div><div class="line">            foo : <span class="string">'bar'</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Ok 模块：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Koa <span class="keyword">from</span> <span class="string">'koa'</span>;</div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Ok</span>(<span class="params">ctx : Koa.Context, data</span>)</span>&#123;</div><div class="line">    ctx.status = <span class="number">200</span>;</div><div class="line">    <span class="keyword">if</span>(data)&#123;</div><div class="line">        ctx.body = &#123;</div><div class="line">            code : <span class="number">200</span>,</div><div class="line">            result : data</div><div class="line">        &#125;;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>因为使用decorator定义router，所以在koa-cola里面不需要单独定义router。</p>
<h3>View</h3>
<p>view 层可以是简单的<code>React.Component</code>或者是 stateless 的函数组件，也可以是使用 react-redux 封装过的组件，<a href="https://github.com/koa-cola/todolist" target="_blank" rel="external">todolist demo</a> 的 view 则使用了<a href="https://github.com/makeomatic/redux-connect" target="_blank" rel="external">redux-connect</a> 提供的 decorator (当然你也可以直接用它的 connect 方法)，redux-connect 也是基于 react-redux，以下是 view 层支持的 react 组件类型。</p>
<h4>React.Component组件</h4>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span>&lt;<span class="title">Props</span>, <span class="title">States</span>&gt;   </span>&#123;</div><div class="line">    <span class="keyword">constructor</span>(props: Props) &#123;</div><div class="line">        <span class="keyword">super</span>(props);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">static</span> defaultProps = &#123;</div><div class="line">        </div><div class="line">    &#125;;</div><div class="line">    render() &#123;</div><div class="line">        <span class="keyword">return</span> &lt;h1&gt;Wow koa-cola!&lt;/h1&gt;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> Index</div></pre></td></tr></table></figure>
<h4>stateless组件</h4>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params">&#123;some_props&#125;</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> &lt;h1&gt;Wow koa-cola!&lt;/h1&gt;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4>react-redux组件</h4>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></div><div class="line"><span class="keyword">const</span> Index = <span class="function"><span class="keyword">function</span>(<span class="params">&#123;some_props&#125;</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> &lt;h1&gt;Wow koa-cola!&lt;/h1&gt;</div><div class="line">&#125;</div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(</div><div class="line">    mapStateToProps,</div><div class="line">    mapDispatchToProps</div><div class="line">)(Index)</div></pre></td></tr></table></figure>
<h4>Cola 装饰器组件</h4>
<p>使用Cola装饰器来封装基于react-redux的组件</p>
<p>如果有子组件也是使用<code>redux-connect</code>封装，则需要使用装饰器<code>include</code></p>
<p>可以参考 todolist 的 <a href="https://github.com/koa-cola/todolist/blob/25e4e3420f656de4aeab064e3a254b056a834003/views/pages/colastyleDemo.tsx#L45" target="_blank" rel="external">colastyleDemo代码</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> AddTodo <span class="keyword">from</span> <span class="string">'../official-demo/containers/AddTodo'</span>;</div><div class="line"><span class="keyword">import</span> FilterLink <span class="keyword">from</span> <span class="string">'../official-demo/containers/FilterLink'</span>;</div><div class="line"><span class="keyword">import</span> VisibleTodoList <span class="keyword">from</span> <span class="string">'../official-demo/containers/VisibleTodoList'</span>;</div><div class="line"><span class="keyword">const</span> &#123;</div><div class="line">  Cola</div><div class="line">  include</div><div class="line">&#125; = <span class="built_in">require</span>(<span class="string">'koa-cola'</span>).Decorators.view;</div><div class="line">@Cola(&#123;</div><div class="line">    initData : &#123;</div><div class="line">        todosData : <span class="keyword">async</span> (&#123; params, helpers, <span class="attr">store</span>: &#123; dispatch &#125; &#125;) =&gt; &#123;</div><div class="line">            <span class="keyword">const</span> api = <span class="keyword">new</span> GetTodoList(&#123;&#125;);</div><div class="line">            <span class="keyword">const</span> data = <span class="keyword">await</span> api.fetch(helpers.ctx);</div><div class="line">            dispatch(&#123;</div><div class="line">                type: <span class="string">'INIT_TODO'</span>,</div><div class="line">                data: data.result.result</div><div class="line">            &#125;);</div><div class="line">            <span class="keyword">return</span> data.result.result;</div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    reducer : &#123;</div><div class="line">        todos,</div><div class="line">        visibilityFilter</div><div class="line">    &#125;</div><div class="line">&#125;)</div><div class="line">@include(&#123; AddTodo, FilterLink, VisibleTodoList &#125;)</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ColastyleDemo</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span>&lt;<span class="title">Props</span>, <span class="title">States</span>&gt; </span>&#123;</div><div class="line">  <span class="keyword">constructor</span>(props: Props) &#123;</div><div class="line">    <span class="keyword">super</span>(props);</div><div class="line">  &#125;</div><div class="line">  render() &#123;</div><div class="line">    <span class="keyword">return</span> &lt;App /&gt;;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">export default ColastyleDemo;</div></pre></td></tr></table></figure>
<h4>自定义 header 和 bundle 方式</h4>
<p>koa-cola 渲染页面时，默认会找<code>views/pages/layout.ts</code>封装页面的 html，如果没有这个<code>layout</code>文件，则直接输出 page 组件返回的 html，如果 view 组件使用了<code>doNotUseLayout</code> decorator，则页面不会使用<code>layout.ts</code>输出，这时你可以自定义<code>header</code>和<code>bundle</code>的 decorator。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">const</span> &#123;</div><div class="line">  header, bundle, doNotUseLayout</div><div class="line">&#125; = <span class="built_in">require</span>(<span class="string">'../../../dist'</span>).Decorators.view;</div><div class="line">@doNotUseLayout</div><div class="line">@bundle([</div><div class="line">  <span class="string">"/bundle.js"</span>,</div><div class="line">  <span class="string">"/test.js"</span></div><div class="line">])</div><div class="line">@header(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line">  <span class="keyword">return</span> &lt;head&gt;</div><div class="line">    &lt;meta name="viewport" content="width=device-width" /&gt;</div><div class="line">  &lt;/head&gt;</div><div class="line">&#125;)</div><div class="line">function Page ()&#123;</div><div class="line">  return &lt;h1&gt;koa-cola&lt;/h1&gt;</div><div class="line">&#125;;</div><div class="line">export default Page</div></pre></td></tr></table></figure>
<h3>Model</h3>
<p><code>controller</code>层、react 组件的<code>view</code>层必须使用 decorator，而<code>model</code>层则没有这个限制，它完全没有耦合。您可以使用 koa-cola 风格来编写 model，以获得更一致的开发体验，也可以随意使用任何 orm 或者 odm，或者不需要 model 层也可以。</p>
<h4>你可以直接在目录 api/models 下创建如 user.ts：</h4>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> * <span class="keyword">as</span> mongoose <span class="keyword">from</span> <span class="string">'mongoose'</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> mongoose.model(<span class="string">'user'</span>, <span class="keyword">new</span> mongoose.Schema(&#123;</div><div class="line">    name : <span class="built_in">String</span>,</div><div class="line">    email : <span class="built_in">String</span></div><div class="line">&#125;))</div></pre></td></tr></table></figure>
<p>然后就可以在其他代码里面使用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> user = <span class="keyword">await</span> app.models.user.find(&#123;<span class="attr">name</span> : <span class="string">'harry'</span>&#125;)</div></pre></td></tr></table></figure>
<h4>使用 koa-cola 的风格写 model</h4>
<p>首先在<code>api/schemas</code>目录创建<code>user.ts</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">export</span> <span class="keyword">const</span> userSchema = <span class="function"><span class="keyword">function</span>(<span class="params">mongoose</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        name: &#123;</div><div class="line">            type : <span class="built_in">String</span></div><div class="line">        &#125;,</div><div class="line">        email : &#123;</div><div class="line">            type : <span class="built_in">String</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在目录<code>api/models</code>下创建 model 如<code>user.ts</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> * <span class="keyword">as</span> mongoose <span class="keyword">from</span> <span class="string">'mongoose'</span></div><div class="line"><span class="keyword">import</span> userSchema <span class="keyword">from</span> <span class="string">'../schemas/user'</span></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> mongoose.model(<span class="string">'user'</span>, <span class="keyword">new</span> mongoose.Schema(userSchema(mongoose)))</div></pre></td></tr></table></figure>
<p>当然也可以使用 decorator 方式定义 model，还可以定义相关hook，详情可以参考<a href="https://github.com/aksyonov/mongoose-decorators" target="_blank" rel="external">mongoose-decorators</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; todoListSchema &#125; <span class="keyword">from</span> <span class="string">'../schemas/todoList'</span>;</div><div class="line"><span class="keyword">const</span> &#123; model &#125; = app.decorators.model;</div><div class="line"></div><div class="line">@model(todoListSchema(app.mongoose))</div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">TodoList</span> </span>&#123;&#125;</div></pre></td></tr></table></figure>
<p>使用 cli 生成 model 的 schema</p>
<p><code>koa-cola --schema</code> 自动生成model的接口定义在<code>typings/schema.ts</code></p>
<p>然后你可以在代码通过使用 typescript 的类型定义，享受 vscode 的 intellisense 带来的便捷</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123;userSchema&#125; <span class="keyword">from</span> <span class="string">'./typings/schema'</span> </div><div class="line"><span class="keyword">const</span> user : userSchema = <span class="keyword">await</span> app.models.user.find(&#123;<span class="attr">name</span> : <span class="string">'harry'</span>&#125;)</div></pre></td></tr></table></figure>
<p>在前面提到的为何需要在<code>api/schemas</code>定义 model 的 schema，除了上面的自动生成 schema 接口，还可以在浏览器端代码复用，比如数据Validate。详细可以查看<a href="http://mongoosejs.com/docs/browser.html" target="_blank" rel="external">文档</a></p>
<h4>koa-cola提供了前后端universal的api接口定义，比如todolist demo的获取数据的接口定义</h4>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; todoListSchema &#125; <span class="keyword">from</span> <span class="string">'./typings/schema'</span>;</div><div class="line"><span class="keyword">import</span> &#123; ApiBase, apiFetch &#125; <span class="keyword">from</span> <span class="string">'koa-cola'</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">GetTodoList</span> <span class="keyword">extends</span> <span class="title">ApiBase</span>&lt;</span></div><div class="line"><span class="class">  </span>&#123;</div><div class="line">      <span class="comment">// 参数类型</span></div><div class="line">  &#125;,</div><div class="line">  &#123;</div><div class="line">    code: number;</div><div class="line">    result: [todoListSchema];</div><div class="line">  &#125;,</div><div class="line">  &#123;</div><div class="line">      <span class="comment">// 异常定义</span></div><div class="line">  &#125;</div><div class="line">&gt; &#123;</div><div class="line">  <span class="keyword">constructor</span>(body) &#123;</div><div class="line">    <span class="keyword">super</span>(body);</div><div class="line">  &#125;</div><div class="line">  url: string = <span class="string">'/api/getTodoList'</span>;</div><div class="line">  method: string = <span class="string">'get'</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在代码里面使用 api，并享受 ts 带来的便捷：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> api = <span class="keyword">new</span> GetTodoList(&#123;&#125;);</div><div class="line"><span class="keyword">const</span> data = <span class="keyword">await</span> api.fetch(helpers.ctx);</div></pre></td></tr></table></figure>
<p><img src="https://github.com/hcnode/koa-cola/raw/master/screenshots/api1.png" alt="Drawing" width="600"><br>
<img src="https://github.com/hcnode/koa-cola/raw/master/screenshots/api2.png" alt="Drawing" width="600"></p>
<p>又比如参数<code>body</code>的定义，如果定义了必传参数，调用时候没有传，则 vscode 会提示错误</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> &#123; testSchema &#125; <span class="keyword">from</span> <span class="string">'./typings/schema'</span>;</div><div class="line"><span class="keyword">import</span> &#123; ApiBase, apiFetch &#125; <span class="keyword">from</span> <span class="string">'koa-cola'</span></div><div class="line"><span class="keyword">export</span> interface ComposeBody&#123;</div><div class="line">    foo : string,</div><div class="line">    bar? : number</div><div class="line">&#125;</div><div class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Compose</span> <span class="keyword">extends</span> <span class="title">ApiBase</span>&lt;<span class="title">ComposeBody</span>, <span class="title">testSchema</span>, </span>&#123;&#125;&gt;&#123;</div><div class="line">    <span class="keyword">constructor</span>(body : ComposeBody)&#123;</div><div class="line">        <span class="keyword">super</span>(body)</div><div class="line">    &#125;</div><div class="line">    url : string = <span class="string">'/compose'</span></div><div class="line">    method : string = <span class="string">'post'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="https://github.com/hcnode/koa-cola/raw/master/screenshots/api3.png" alt="Drawing" width="600"></p>

    </div>
  </div>
  <div class='switch-page'>
    
      <a class='previous' href='/doc/universal.html'>Previous</a>
    
    
      <a class='next' href='/doc/installation.html'>Next</a>
    
  </div>
</body>
</html>
